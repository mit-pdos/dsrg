
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>EPaxos - DSRG</title>
  <meta name="author" content="DSRG">

  
  <meta name="description" content="EPaxos
is a leaderless Paxos variant which tries to reduce latencies for
a geo-distributed replica group by:
1. enabling the client to use the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://pdos.csail.mit.edu/dsrg/blog/2014/01/10/epaxos">
  <link href="/dsrg/favicon.png" rel="icon">
  <link href="/dsrg/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/dsrg/atom.xml" rel="alternate" title="DSRG" type="application/atom+xml">
  <script src="/dsrg/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/dsrg/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-968607-14']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/dsrg/">DSRG</a></h1>
  
    <h2>Distributed systems reading group at MIT</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/dsrg/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:pdos.csail.mit.edu/dsrg" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/dsrg/about">About</a></li>
  <li><a href="/dsrg/">Blog</a></li>
  <li><a href="/dsrg/schedule">Schedule</a></li>
  <li><a href="/dsrg/papers">Papers</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">EPaxos</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-10T13:04:00-05:00" pubdate data-updated="true">Jan 10<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><a href="https://github.com/efficient/epaxos">EPaxos</a>
is a leaderless Paxos variant which tries to reduce latencies for
a geo-distributed replica group by:
1. enabling the client to use the replica with the lowest round-trip latency as the operation leader
2. optimistically skipping a round of replica communication by inter-operation conflict detection</p>

<p>Instead of explaining EPaxos in this post, I will go over an example of how the
recovery protocol works. This example confused me for a while since it is not
actually addressed in the SOSP&#8217;13 paper &mdash; the full recovery protocol is in the
<a href="http://www.pdl.cmu.edu/PDL-FTP/associated/CMU-PDL-13-111.pdf">tech report</a>.
Therefore, I recommend you read the recovery protocol in the tech report before
you start playing EPaxos with toy examples.</p>

<h2>Failure and recovery scenario</h2>

<p>Consider a replica group of five nodes. The fast-path quorum size for five
replicas is 3 (F + floor((F + 1)/2)), making the EPaxos fast-path quorum the
same size as a simple majority. Let us name the replicas like so:</p>

<pre>
        A   B
      C   D   E
</pre>


<p>One situation that could be problematic occurs when a client completes two
operations (which have side-effects i.e. writes), issuing one after the other
with the per-operation leader replying success for both, but then some failure
occurs and the recovery protocol incorrectly orders the second operation before
the first.</p>

<p>Suppose the first operation uses A as leader with C and D making up the other
fast-path quorum members while the second operation uses B as leader with D and
E as quorum members. Furthermore, let&rsquo;s say that A fast-path commits operation
1, responding success to the client but crashing right before it sends &ldquo;commit&rdquo;
messages to C and D. Then, B sends pre-accepts to D and E (without operation 1
in the deps because B doesn&rsquo;t know about operation 1) and also crashes. The
system has suffered two failures but must recover and continue operation since
five replicas can tolerate two failures in EPaxos. However, the remaining
replicas look like this (with subscripts representing which operation the
replica has pre-accepted in its log):</p>

<pre>
        X   X
      C_1 D_1 E_2
</pre>


<p>At this point, each replica knows about only one of the two operations but not
whether it is committed, and both operations conflict with each other (see the
tech report section 6.2 number 6 for exactly what &ldquo;conflicts&rdquo; means). But when
C, D, or E initiates recovery for operations 1 and 2, how does it know which
operation, if any, was fast-path committed and in which order?</p>

<p>Turns out we can figure out this mess if we know the leaders for both
operations &mdash; this is exactly what EPaxos does in this situation. If the leader
of an operation, alpha, is in the fast-path quorum of a different operation,
beta, then beta could not have been fast-path committed if the pre-accept
messages for alpha do not contain beta in deps.</p>

<p>The recovery would proceed as follows. Suppose C initiates recovery for
operation 1. First, it asks the fast-path quorum what their logs contain. C
observes that at least floor((F + 1)/2) replicas (C and D) have pre-accepted an
operation with the identical default attributes, and then tries to convince
other replicas to accept the operation until at least F + 1 have accepted it.
When C asks E to accept operation 1, E refuses since operation 1 conflicts with
operation 2 and E has already pre-accepted operation 2. Therefore, C will defer
the recovery of operation 1 (section 6.2, step 7-e) and instead try to recover
the operation it conflicts with, operation 2.</p>

<p>For the recovery of operation 2, replicas C and D will not accept operation 2
and will respond with the conflicting operation and the identity of the leader
for the conflicting operation. The recovering replica will now observe that the
leader for operation 1, replica A, is in the fast-path quorum for operation 2,
but that A clearly didn&rsquo;t know about operation 2; otherwise it would have
listed operation 2 as a dependency for operation 1 in the pre-accept messages.
Thus operation 2 could not have been fast-path accepted. Operation 2 would then
be filled with a no-op and the recovery of operation 1 would be resolved,
concluding that operation 1 was fast-path committed (note that it is always
safe to conclude that an operation was fast-path committed if there are no
conflicts, even if the operation in question wasn&rsquo;t).</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">DSRG</span></span>

      








  


<time datetime="2014-01-10T13:04:00-05:00" pubdate data-updated="true">Jan 10<span>th</span>, 2014</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://pdos.csail.mit.edu/dsrg/blog/2014/01/10/epaxos/" data-via="" data-counturl="http://pdos.csail.mit.edu/dsrg/blog/2014/01/10/epaxos/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/dsrg/blog/2013/12/16/sinfonia/" title="Previous Post: Sinfonia">&laquo; Sinfonia</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/dsrg/blog/2014/01/10/epaxos/">EPaxos</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/12/16/sinfonia/">Sinfonia</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/09/30/spark-streaming/">Discretized Streams</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/09/30/spanstore/">SPANStore</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/08/08/chain-replication/">Chain Replication</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/07/25/mdcc/">MDCC</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/07/18/coralcdn/">CoralCDN</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/07/11/zookeeper/">Zookeeper</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/07/03/thialfi/">Thialfi</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/06/20/vr-revisited/">VR Revisited</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/06/13/cheriton-and-skeen/">Cheriton and Skeen</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/06/06/pacifica/">PacificA</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/05/30/spanner/">Spanner</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/05/23/raft/">Raft</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - DSRG -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dsrg';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://pdos.csail.mit.edu/dsrg/blog/2014/01/10/epaxos/';
        var disqus_url = 'http://pdos.csail.mit.edu/dsrg/blog/2014/01/10/epaxos/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
