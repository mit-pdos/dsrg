
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Zookeeper - DSRG</title>
  <meta name="author" content="DSRG">

  
  <meta name="description" content="Why did we read this paper? Zookeeper
is a practical system with replicated storage used by Yahoo!.
We are interested in understanding what &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://pdos.csail.mit.edu/dsrg/blog/2013/07/11/zookeeper">
  <link href="/dsrg/favicon.png" rel="icon">
  <link href="/dsrg/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/dsrg/atom.xml" rel="alternate" title="DSRG" type="application/atom+xml">
  <script src="/dsrg/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/dsrg/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-968607-14']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/dsrg/">DSRG</a></h1>
  
    <h2>Distributed systems reading group at MIT</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/dsrg/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:pdos.csail.mit.edu/dsrg" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/dsrg/about">About</a></li>
  <li><a href="/dsrg/">Blog</a></li>
  <li><a href="/dsrg/schedule">Schedule</a></li>
  <li><a href="/dsrg/papers">Papers</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Zookeeper</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-11T15:00:00-04:00" pubdate data-updated="true">Jul 11<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Why did we read this paper?</h2>

<p><a href="http://static.usenix.org/event/usenix10/tech/full_papers/Hunt.pdf">Zookeeper</a>
is a practical system with replicated storage used by Yahoo!.
We are interested in understanding what replication protocol Zookeeper uses, why they
needed a <em>new</em> replication protocol, what applications/services people build upon it,
and what features are required to make such a replicated storage system
practical.</p>

<p>Also, Zookeeper has pretty good performance for a replication
protocol. It is interesting to see how it works.</p>

<h2>What is Zookeeper</h2>

<p>The Zookeeper design consists of three components &ndash; replicated storage,
relaxed consistent caching at clients, and detection of client failures.</p>

<h2>Replication</h2>

<p>Zookeeper provides a key/value data model, where keys are named like the paths of
a file system and values are arbitrary blobs. They call each key/value pair a
<em>Znode</em>. Each Znode must be accessed with a full path so that Zookeeper doesn&rsquo;t
have to implement open/close. Each value has a version number and an internal
sequence number, which they use a lot when building applications/services presented
in the paper. Each Znode can have its own value, and a collection of children.</p>

<p>Data can be accessed with get/set/create/delete methods. Zookeeper supports
conditional versions of these operations too. For example, a client can say
set the value of &ldquo;/ds-reading/schedule&rdquo; to &ldquo;3pm,thursday&rdquo; only if the Znode&rsquo;s
current version is 100. This feature is used widely in the the presented
applications/services.</p>

<p>Znodes are replicated via what they called Zab, an atomic broadcast protocol.
Zab is their own replication protocol. It seems quite similar to viewstamped
replication (VR). The only difference I can tell is that Zab is special case
of viewstamped based replication. Zab requires clients to send requests
in order (thus they use TCP), but VR does not. Zab also requires the requests
to be idempotent, so that a new leader can re-propose the most recent request
without detecting duplicated requests.</p>

<p>Despite Zab&rsquo;s restriction for replication of only idempotent operations, Zookeeper does
support non-idempotent operations. The trick is that for each potentially
non-idempotent request, the leader converts it to idempotent requests by
executing it locally.</p>

<h2>Relaxed consisent caching</h2>

<p>Another component of Zookeeper is relaxed consistent caching between clients
and Zookeeper. When clients get data from Zookeeper, clients can cache it, and
optionally register at Zookeeper to receive notifications if the accessed Znode
changes.  Zookeeper will send notifications to caching clients ASYNCHRONOUSLY
once the data is changed. The benefit of this is that updates don&rsquo;t have to wait for
invalidations to complete, thus they don&rsquo;t suffer from the impact of client failure;
the downside is that now the client&rsquo;s cache is not consistent with Zookeeper.</p>

<p>The notification doesn&rsquo;t contain the actual update, and each registration is
triggered only once (the server deletes it once the notification is delivered).</p>

<h2>Detection of client failures</h2>

<p>Zookeeper supports a special Znode type called &ldquo;ephemeral Znode&rdquo; to detect the
failure of clients.  If a session terminates, all ephemeral ZNodes created
within that session are deleted. Services/applications can use it to detect
failure. For example, Katta uses it to detect master failure.</p>

<h2>Other design choices</h2>

<p>Zookeeper allows applications and services to choose their own level of consistency.  Zookeeper
linearizes all writes. Reads are served from a local Zookeeper server, but a
client can linearize reads using the sync() API.</p>

<h2>Comments</h2>

<p>In all, we feel that ZooKeeper is cool. It provides building blocks that people
can use to construct their own services with different consistency/performance
requirements. It also simplifies the building of other services, as demonstrated
in the paper.</p>

<p>One thing we didn&rsquo;t understand is why the paper makes the claim that
ZooKeeper is not intended for general storage.  It seems like that
would work.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">DSRG</span></span>

      








  


<time datetime="2013-07-11T15:00:00-04:00" pubdate data-updated="true">Jul 11<span>th</span>, 2013</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://pdos.csail.mit.edu/dsrg/blog/2013/07/11/zookeeper/" data-via="" data-counturl="http://pdos.csail.mit.edu/dsrg/blog/2013/07/11/zookeeper/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/dsrg/blog/2013/07/03/thialfi/" title="Previous Post: Thialfi">&laquo; Thialfi</a>
      
      
        <a class="basic-alignment right" href="/dsrg/blog/2013/07/18/coralcdn/" title="Next Post: CoralCDN">CoralCDN &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/dsrg/blog/2013/12/16/sinfonia/">Sinfonia</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/09/30/spark-streaming/">Discretized Streams</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/09/30/spanstore/">SPANStore</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/08/08/chain-replication/">Chain Replication</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/07/25/mdcc/">MDCC</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/07/18/coralcdn/">CoralCDN</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/07/11/zookeeper/">Zookeeper</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/07/03/thialfi/">Thialfi</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/06/20/vr-revisited/">VR Revisited</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/06/13/cheriton-and-skeen/">Cheriton and Skeen</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/06/06/pacifica/">PacificA</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/05/30/spanner/">Spanner</a>
      </li>
    
      <li class="post">
        <a href="/dsrg/blog/2013/05/23/raft/">Raft</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - DSRG -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dsrg';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://pdos.csail.mit.edu/dsrg/blog/2013/07/11/zookeeper/';
        var disqus_url = 'http://pdos.csail.mit.edu/dsrg/blog/2013/07/11/zookeeper/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
