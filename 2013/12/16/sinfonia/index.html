<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Sinfonia</title>
  <meta name="description" content="Sinfoniais a service that allows hosts to share application data in afault-tolerant, scalable, and consistent manner using a novelmini-transaction primitive....">

  <base href="/" />
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://dsrg.pdos.csail.mit.edu/2013/12/16/sinfonia/">
  <link rel="alternate" type="application/rss+xml" title="Distributed Systems Reading Group" href="http://dsrg.pdos.csail.mit.edu/feed.xml" />
  <link href='/stylesheets/all-b5d41f4fa671ec94597e984da68527b0.css' media='all' rel='stylesheet' type='text/css'>
  <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Distributed Systems Reading Group</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/papers/">Papers</a>
          
        
          
          <a class="page-link" href="/schedule/">Schedule</a>
          
        
      </div>
    </nav>

  </div>

</header>

    <div class="page-content">
      <div class="wrapper">
        <aside class="recent-posts">
  <h2>Recent posts</h2>
  <ul>
      
        <li>
          <span class="post-meta">Jan 10, 2014</span>
          <h2>
            <a class="post-link" href="/2014/01/10/epaxos/">EPaxos</a>
          </h2>
        </li>
      
        <li>
          <span class="post-meta">Dec 16, 2013</span>
          <h2>
            <a class="post-link" href="/2013/12/16/sinfonia/">Sinfonia</a>
          </h2>
        </li>
      
        <li>
          <span class="post-meta">Sep 30, 2013</span>
          <h2>
            <a class="post-link" href="/2013/09/30/spark-streaming/">Discretized Streams</a>
          </h2>
        </li>
      
        <li>
          <span class="post-meta">Sep 30, 2013</span>
          <h2>
            <a class="post-link" href="/2013/09/30/spanstore/">SPANStore</a>
          </h2>
        </li>
      
        <li>
          <span class="post-meta">Aug 8, 2013</span>
          <h2>
            <a class="post-link" href="/2013/08/08/chain-replication/">Chain Replication</a>
          </h2>
        </li>
      
        <li>
          <span class="post-meta">Jul 25, 2013</span>
          <h2>
            <a class="post-link" href="/2013/07/25/mdcc/">MDCC</a>
          </h2>
        </li>
      
        <li>
          <span class="post-meta">Jul 18, 2013</span>
          <h2>
            <a class="post-link" href="/2013/07/18/coralcdn/">CoralCDN</a>
          </h2>
        </li>
      
        <li>
          <span class="post-meta">Jul 11, 2013</span>
          <h2>
            <a class="post-link" href="/2013/07/11/zookeeper/">Zookeeper</a>
          </h2>
        </li>
      
        <li>
          <span class="post-meta">Jul 3, 2013</span>
          <h2>
            <a class="post-link" href="/2013/07/03/thialfi/">Thialfi</a>
          </h2>
        </li>
      
        <li>
          <span class="post-meta">Jun 20, 2013</span>
          <h2>
            <a class="post-link" href="/2013/06/20/vr-revisited/">VR Revisited</a>
          </h2>
        </li>
      
  </ul>
</aside>
<div class="post">

  <header class="post-header">
    <h1 class="post-title">Sinfonia</h1>
    <p class="post-meta">Dec 16, 2013</p>
  </header>

  <article class="post-content">
    <p><a href="http://www.cs.princeton.edu/courses/archive/fall08/cos597B/papers/sinfonia.pdf">Sinfonia</a>
is a service that allows hosts to share application data in a
fault-tolerant, scalable, and consistent manner using a novel
mini-transaction primitive. We read this paper because it provides an
interesting alternative to message passing for building distributed
systems.</p>

<h2 id="data-layout">Data Layout</h2>

<p>At a high level, Sinfonia provides multiple independent linear address
spaces that live on <em>memory nodes</em>. No structure is imposed on these
address spaces, and they can contain arbitrary bytes of data. Data in
Sinfonia is referenced using a pair: <code>(memory-node-id, offset)</code>.
Sinfonia does not perform automatic load balancing, and data placement
is left to the application.</p>

<h2 id="mini-transactions">Mini-transactions</h2>

<p>Operations on data take the form of <em>mini-transactions</em>, which are
basically distributed compare and swap/read operations. A
mini-transaction consists of a triple <code>(compare-set, write-set,
read-set)</code>. Elements in the compare-set are tuples: <code>(memory-node-id,
offset, length, data)</code> where the first three fields describe the
location and size of the data to compare, and the last field is the
value expected at that location. The write-set is the same, except that
the last field is the value to write to the location. Elements in the
read-set are similar, but they omit the data field.</p>

<p>The mini-transaction performs the following operation atomically:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">if</span> <span class="n">compare</span><span class="o">-</span><span class="n">set</span> <span class="n">comparisons</span> <span class="n">match</span> <span class="n">expected</span> <span class="n">data</span> <span class="p">&#x7b;</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">Perform</span> <span class="n">each</span> <span class="n">write</span> <span class="n">in</span> <span class="n">write</span><span class="o">-</span><span class="n">set</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="n">Return</span> <span class="n">each</span> <span class="n">read</span> <span class="n">in</span> <span class="n">read</span><span class="o">-</span><span class="n">set</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7d;</span></div></div></pre></div></figure>

<p>For example, an atomic compare and swap operation on the first byte at
memory node 0 (where the expected value is “5” and the new value is “6”)
would be:</p>

<figure class="code-highlight-figure"><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="p">&#x7b;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="p">&#x7d;,</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="p">&#x7b;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="p">&#x7d;,</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="p">&#x7b;&#x7d;</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">)</span></div></div></pre></div></figure>

<p>Mini-transactions are committed using a 2-phase commit protocol where
application nodes are coordinators and memory nodes are participants,
but mini-transactions operating on a single participant use only a
single phase. This allows for operations that perform writes on one
memory node as a result of a compare on another memory node. The paper
gives several examples of powerful operations that can be implemented
using mini-transactions, including: atomic reads across multiple memory
nodes, compare and swap, acquiring multiple leases atomically, and
changing data if a lease is held.</p>

<p>Mini-transactions were designed so that the operation itself can
piggyback on the commit protocol for added performance.  This does not
work for arbitrary transactions, but the restricted operations available
for mini-transactions allows this optimization.  For example, a
participant can vote “no” to commit a transaction if it knows that the
coordinator will abort the transaction as a result of a value it is
reading (this occurs when a comparison in the compare-set fails).
Additionally, the results for reads in mini-transactions are included
with the vote for committing in the first phase.</p>

<p>The design of mini-transactions permits this kind of optimization, but
it makes certain operations impossible to fit in a single
mini-transaction. For example, reading and copying data between memory
nodes requires two mini-transactions (one to read the data and another
that atomically checks that the data is still valid and writes the data
to another memory node).</p>

<h2 id="design">Design</h2>

<p>Overall, Sinfonia provides an alternative to message passing for
implementing distributed systems. Rather than explicitly sending
messages, applications describe operations on shared data in terms of
mini-transactions that are executed atomically using 2-phase commit.</p>

<p>Sinfonia uses logging and replication to provide fault tolerance and
reduce downtime. The design of Sinfonia, however, does not support
automatic load-balancing or caching. Load-balancing and caching are left
to the application developer who is given some load information by the
system.</p>

<p>Coordinator crashes are handled using a recovery coordinator, which is
triggered when a transaction has not been committed or aborted after
some timeout. The recovery coordinator asks each participant how it
voted on that transaction, and the participant replies with its original
vote if it had already voted or <code>ABORT</code> if it had not (remembering that
it must abort this transaction in the future if the original coordinator
reappears).</p>

<p>Sinfonia uses a write-ahead redo-log for performance and fault-tolerance
for the participants.  When a participant votes to commit, the
transaction data is added to the redo-log which is replayed if the
participant crashes. Participants also keep track of decided
transactions so they know if they can commit the changes or not.  Other
participants must be contacted for their votes if the recovered
participant does not know how the transaction was decided.</p>

<h2 id="comments">Comments</h2>

<p>Sinfonia provides an interesting alternative to message passing in
distributed systems, but requires application developer intervention to
provide data locality, caching, and data placement. The paper details
several optimizations, which are especially important for
mini-transaction performance. The paper also includes interesting
applications built on top of Sinfonia: a file system and a group
communication service, which show how Sinfonia can be used to implement
real-world applications.</p>

<p>Mini-transactions are somewhat limited in what operations they can
perform, but the operations they do support can be efficiently executed.</p>

  </article>

</div>


        
          <div id="disqus_thread"></div>
          <script type="text/javascript">
              var disqus_shortname = 'dsrg';
              var disqus_url = 'http://dsrg.pdos.csail.mit.edu/2013/12/16/sinfonia/';
              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        
      </div>
    </div>

    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-968607-14']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>

</html>
